name:    arkham-api
version: "0.0.0"

default-extensions:
  - BangPatterns
  - DataKinds
  - DeriveAnyClass
  - DeriveFoldable
  - DeriveFunctor
  - DeriveGeneric
  - DeriveLift
  - DeriveTraversable
  - DerivingStrategies
  - DerivingVia
  - FlexibleContexts
  - FlexibleInstances
  - GADTs
  - GeneralizedNewtypeDeriving
  - LambdaCase
  - MultiParamTypeClasses
  - NoImplicitPrelude
  - NoMonomorphismRestriction
  - OverloadedStrings
  - RankNTypes
  - RecordWildCards
  - ScopedTypeVariables
  - StandaloneDeriving
  - TypeApplications
  - TypeFamilies

dependencies:
  - base

library:
  source-dirs: library
  when:
    - condition: (flag(dev)) || (flag(library-only))
      then:
        ghc-options:
        - -Wall
        - -fwarn-tabs
        - -O0
        cpp-options: -DDEVELOPMENT
      else:
        ghc-options:
        - -Wall
        - -fwarn-tabs
        - -O2
  dependencies:
    - arkham-core
    - aeson
    - aeson-casing
    - bcrypt
    - bytestring
    - case-insensitive
    - classy-prelude
    - classy-prelude-yesod
    - conduit
    - containers
    - esqueleto
    - fast-logger
    - file-embed
    - http-client-tls
    - http-conduit
    - http-types
    - jwt
    - monad-logger
    - persistent
    - persistent-postgresql
    - persistent-template
    - regex-posix
    - safe
    - string-conversions
    - template-haskell
    - text
    - time
    - transformers
    - unliftio
    - unordered-containers
    - uri-bytestring
    - uuid
    - vector
    - wai
    - wai-extra
    - wai-logger
    - warp
    - yaml
    - yesod
    - yesod-core
    - yesod-static
    - yesod-websockets

executables:
  arkham-api:
    main: main.hs
    source-dirs: app
    ghc-options:
    - -threaded
    - -rtsopts
    - -with-rtsopts=-N
    dependencies:
      - foreign-store
      - warp
      - arkham-api
    when:
      - condition: flag(library-only)
        buildable: false

flags:
  library-only:
    description: Build for use with "yesod devel"
    manual: false
    default: false
  dev:
    description: Turn on development settings, like auto-reload templates.
    manual: false
    default: false
